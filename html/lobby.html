<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Word Search Game Lobby</title>
    <link rel="stylesheet" href="style_lobby.css">
</head>
<body>
    <div id="lobbyContainer">
        <div id="userInputSection">
            <button id="helpButton">HELP</button>
            <div>
                <label for="nickInput">Insert Nick:</label>
                <input type="text" id="nickInput" placeholder="Type here">
            </div>
            <div>
                <label for="gameSelect">Game:</label>
                <select id="gameSelect">

                </select>
            </div>
            <div>
                <label for="modeSelect">Game Mode:</label>
                <select id="modeSelect">
                </select>
            </div>
            <button id="confirmButton">CONFIRM</button>
            <h1>The Word Search Game</h1>
            <button id="startButton">START</button>
            <button id="leaveButton">LEAVE</button>
            <button id="refreshButton">Refresh</button>
        </div>
        <div id="gameListSection">

        </div>
    </div>

    <script>
        var socket = new WebSocket("ws://localhost:9105");

        socket.onopen = function(evt) {
            console.log("Open");
            requestGameList();
        };

        socket.onmessage = function(evt) {
            console.log("Message received: " + evt.data);
            var messageData = JSON.parse(evt.data);
        };

        socket.onclose = function(evt) {
            console.log("WebSocket connection closed.");
            document.getElementById("topMessage").innerText = "Server Offline";
        };

        socket.onerror = function(evt) {
            console.error("WebSocket error: " + evt.message);
        };

        function requestGameList() {
            var data = { type: "RequestGameList" };
            socket.send(JSON.stringify(data));
        }

        function updateGameList(serverData) 
        {
            var gameListSection = document.getElementById('gameListSection');
            gameListSection.innerHTML = ''; 

            serverData.forEach(function(game) {
                var gameDiv = document.createElement('div');
                gameDiv.innerHTML = '<span>' + game.gameName + '</span>' +
                                '<span>' + game.filledSlots + '/' + game.maxSlots + '</span>' +
                                '<button onclick="joinGame(' + game.gameId + ')">Join</button>';
                gameListSection.appendChild(gameDiv);
        });
        }

        // event listeners for user actions
        document.getElementById('confirmButton').addEventListener('click', function() {
            var nick = document.getElementById('nickInput').value.trim();
            var gameIndex = document.getElementById('gameSelect').value;
            var mode = document.getElementById('modeSelect').value;

            if (!nick) 
            {
                alert('Please enter a nickname.');
                return;
            }
            if (!gameIndex || !mode) 
            {
                alert('Please select a game and mode.');
                return;
            }
            joinGame(nick, gameIndex, mode);
        });


        // replace joinGame function with one that sends a WebSocket message
        function joinGame(nick, gameIndex, mode) {
            var data = {
                type: "JoinGame",
                nick: nick,
                gameIndex: gameIndex,
                modeIndex: mode
            };
            socket.send(JSON.stringify(data));
        }

        // replace leaveGame function with one that sends a WebSocket message
        function leaveGame(nick) {
            var data = {
                type: "LeaveGame",
                nick: nick
            };
            socket.send(JSON.stringify(data));
        }

        // event listener for the leave button
        document.getElementById('leaveButton').addEventListener('click', function() {
            var nick = document.getElementById('nickInput').value;
            leaveGame(nick);
        });

        // add an event listener for the refresh button to request the game list
        document.getElementById('refreshButton').addEventListener('click', function() {
            requestGameList();
        });
    </script>
</body>
</html>

